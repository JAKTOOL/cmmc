"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[532],{6616:(e,t,r)=>{r.d(t,{o:()=>c});var l=r(5155),n=r(970),s=r(6874),i=r.n(s),a=r(2115);let o=e=>null==e?void 0:e.requirement;function d(e){let t=e.getBoundingClientRect();return t.top>=82&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}let c=e=>{let{previous:t,next:r,elementType:s="requirement",elementIdentity:c=o}=e,u=(0,n._A)(),m=(0,n.b0)(u),x=(0,a.useRef)(null),p=(0,a.useRef)(null),h="rounded-r-lg rounded-l-lg";t&&(h="rounded-r-lg");let f="rounded-r-lg rounded-l-lg";r&&(f="rounded-l-lg border-r"),(0,a.useEffect)(()=>{p.current&&d(p.current)?p.current.focus():x.current&&d(x.current)&&x.current.focus()},[x,p]);let v=c(t),b=c(r);return(0,l.jsxs)("aside",{className:"w-5/6 flex flex-row mb-4",children:[t&&(0,l.jsxs)(i(),{href:"".concat(m,"/").concat(s,"/").concat(v),className:"flex flex-row items-center bg-gray-200 text-gray-700 border-gray-400 py-2 px-4 border-b-4 hover:bg-gray-300 ".concat(f),tabIndex:10,ref:x,children:[(0,l.jsx)("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),(0,l.jsxs)("span",{className:"mr-4 ml-2",children:[(0,l.jsx)("span",{children:v}),!!t.title&&(0,l.jsxs)("span",{className:"hidden md:inline",children:[": ",t.title]})]})]}),r&&(0,l.jsxs)(i(),{href:"".concat(m,"/").concat(s,"/").concat(b),className:"flex flex-row items-center bg-gray-200 text-gray-700 border-gray-400 py-2 px-4 border-b-4 hover:bg-gray-300 ".concat(h),tabIndex:11,ref:p,children:[(0,l.jsxs)("span",{className:"ml-4 mr-2",children:[(0,l.jsx)("span",{children:b}),!!r.title&&(0,l.jsxs)("span",{className:"hidden md:inline",children:[": ",r.title]})]}),(0,l.jsx)("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})]})}},8532:(e,t,r)=>{r.d(t,{SecurityRequirements:()=>Y});var l=r(5155),n=r(7580),s=r(970),i=r(5383),a=r(8947),o=r(5695),d=r(2115),c=r(2789),u=r(170),m=r(8870),x=r(6874),p=r.n(x),h=r(1457);let f=e=>{let{rows:t}=e;return(0,l.jsx)("dl",{className:"flex flex-row",children:t.reduce((e,t,r)=>(void 0!==t.visible&&t.visible&&e.push((0,l.jsxs)("div",{className:t.className||"",children:[(0,l.jsx)("dt",{className:"text-xs text-gray-700 uppercase bg-gray-50 text-gray-700 border-gray-100 py-2 px-4 text-left border-r-2 border-b-2",children:t.title}),(0,l.jsx)("dd",{className:"text-xs text-gray-500 bg-white border-gray-200 py-2 px-4",children:t.value})]},r)),e),[])})};var v=r(1491),b=r(8202),g=r(3437),j=r(2954),w=r(6616),y=r(5735),N=r(9252);let k=async e=>{let{requirementId:t,type:r,name:l,data:n}=e,s=[...new Uint8Array(await window.crypto.subtle.digest("SHA-1",n))].map(e=>e.toString(16).padStart(2,"0")).join(""),i=r.includes("image/")?".".concat(r.replace("image/","")):"",a=l||"".concat(s.slice(0,8)).concat(i);return{uuid:s,filename:a,type:r,data:n,requirement_id:t}},q=()=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"h-4 mr-1",children:(0,l.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 12.5V6.8c0-1.68 0-2.52-.327-3.162a3 3 0 0 0-1.311-1.311C17.72 2 16.88 2 15.2 2H8.8c-1.68 0-2.52 0-3.162.327a3 3 0 0 0-1.311 1.311C4 4.28 4 5.12 4 6.8v10.4c0 1.68 0 2.52.327 3.162a3 3 0 0 0 1.311 1.311C6.28 22 7.12 22 8.8 22h3.7m2.5-3 3 3m0 0 3-3m-3 3v-6"})}),S=()=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"h-4 mr-1",children:(0,l.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})}),I=()=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"h-4 mr-1",children:(0,l.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 9V3m0 0h-6m6 0-8 8m-3-6H7.8c-1.68 0-2.52 0-3.162.327a3 3 0 0 0-1.311 1.311C3 7.28 3 8.12 3 9.8v6.4c0 1.68 0 2.52.327 3.162a3 3 0 0 0 1.311 1.311C5.28 21 6.12 21 7.8 21h6.4c1.68 0 2.52 0 3.162-.327a3 3 0 0 0 1.311-1.311C19 18.72 19 17.88 19 16.2V14"})}),R=e=>{let{requirementId:t,setUploading:r,uploading:n}=e,s=async e=>{var l;if(r(!0),null==e||null==(l=e.target)?void 0:l.files){for(let r of e.target.files){let e=await (0,y.AO)(r),l=await k({name:r.name,type:r.type,data:e,requirementId:t});await i.Iq.evidence.put(l)}r(!1)}};return(0,l.jsxs)("label",{htmlFor:"evidence",className:"flex flex-col items-center justify-center border border-gray-200 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,l.jsx)("svg",{className:"w-8 h-8 mb-4 text-gray-500","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 16",children:(0,l.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"})}),(0,l.jsxs)("p",{className:"mb-2 text-sm text-gray-500 p-2",children:["Click or drop evidence for ",t]})]}),(0,l.jsx)("input",{id:"evidence",type:"file",className:"hidden",multiple:!0,onChange:s,disabled:n})]})},E=e=>{let{artifact:t}=e,r="url"!==t.type?t.filename.lastIndexOf("."):-1,n="url"!==t.type?t.filename.slice(0,r):t.filename,s=(0,d.useRef)(null);return(0,d.useEffect)(()=>{var e,t;null==(e=s.current)||e.focus(),null==(t=s.current)||t.select()},[null==s?void 0:s.current]),(0,l.jsxs)("label",{className:"text-blue-800 border border-blue-200 flex items-center me-2",children:[(0,l.jsx)("input",{type:"text",className:"py-0.5 pl-2.5",id:"name.".concat(t.uuid),name:"name.".concat(t.uuid),placeholder:n,defaultValue:n,ref:s}),(0,l.jsx)("button",{type:"submit",className:"bg-blue-100 text-blue-800 border border-blue-200 text-xs font-medium px-2.5 py-0.5 rounded-sm h-full",children:(0,l.jsx)("svg",{className:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m18 10-4-4M2.5 21.5l3.384-.376c.414-.046.62-.069.814-.131a2 2 0 0 0 .485-.234c.17-.111.317-.259.61-.553L21 7a2.828 2.828 0 1 0-4-4L3.794 16.206c-.294.294-.442.442-.553.611a2 2 0 0 0-.234.485c-.062.193-.085.4-.131.814z"})})})]})},L=e=>{let{children:t,onDelete:r,artifact:n,lastResetAt:s}=e,[i,a]=(0,d.useState)(!1),[o,c]=(0,d.useState)(s);return((0,d.useEffect)(()=>{s!==o&&(a(!1),c(s))},[s,o]),i)?(0,l.jsx)(E,{artifact:n}):(0,l.jsxs)("span",{className:"flex shrink items-center max-h-[20px] bg-blue-100 text-blue-800 border border-blue-200 text-xs font-medium me-2 mb-2 px-2.5 py-0.5 rounded-sm",onContextMenu:function(e){e.preventDefault(),a(!i)},children:[t,(0,l.jsx)("button",{onClick:r,className:"pl-2",children:(0,l.jsx)("svg",{className:"w-2 h-2","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",children:(0,l.jsx)("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})})})]})},_=e=>{let{artifact:t}=e,r=async()=>{let e=new File([t.data],t.filename,{type:t.type}),r=await (0,y.dY)(e);Object.assign(document.createElement("a"),{target:"_blank",rel:"noopener noreferrer",href:r}).click()};return(0,l.jsxs)("button",{className:"border-r border-blue-200 pr-2 flex",title:"".concat(t.data.byteLength," bytes | ").concat(t.type),onClick:r,children:[(0,l.jsx)(q,{}),(0,l.jsx)("span",{children:t.filename})]})},M=e=>{let{artifact:t}=e,r=new TextDecoder().decode(t.data),n=async()=>{Object.assign(document.createElement("a"),{target:"_blank",rel:"noopener noreferrer",href:r}).click()};return(0,l.jsxs)("button",{className:"border-r border-blue-200 pr-2 flex",title:"".concat(r),onClick:n,children:[(0,l.jsx)(I,{}),(0,l.jsx)("span",{children:t.filename})]})},A=e=>{let{artifact:t,setEvidence:r,evidence:n,lastResetAt:s}=e,a=async()=>{await i.Iq.evidence.delete(IDBKeyRange.only(t.uuid))&&r(n.filter(e=>e.uuid!==t.uuid))};return(0,l.jsx)(L,{onDelete:a,artifact:t,lastResetAt:s,children:"url"===t.type?(0,l.jsx)(M,{artifact:t}):(0,l.jsx)(_,{artifact:t})})},T=e=>{let{evidence:t,setEvidence:r,lastResetAt:n}=e;return null==t?void 0:t.map(e=>(0,l.jsx)(A,{artifact:e,evidence:t,setEvidence:r,lastResetAt:n},e.uuid))};async function C(e,t){t(await i.Iq.evidence.getAll(IDBKeyRange.only(e),"requirement_id"))}let P=e=>{let{requirementId:t}=e,[r,n]=(0,d.useState)([]),[s,a]=(0,d.useState)(!1),[o,c]=(0,d.useState)(null),u=(0,d.useRef)(null),{addNotification:m}=(0,N.h)(),x=(0,d.useMemo)(()=>r.reduce((e,t)=>(e[t.uuid]=t,e),{}),[r]),p=async(e,r)=>{let l=!1;if(r.get("url")){let e=r.get("url"),n=new URL(e),s=new TextEncoder().encode(e),a=await k({name:n.host||n.href,type:"url",data:s.buffer,requirementId:t});await i.Iq.evidence.put(a),l=!0}else for(let e of r.keys())if(e.startsWith("name.")){let t=x[e.slice(5)],n="";if("url"!==t.type){let e=t.filename.lastIndexOf(".");n=t.filename.slice(e)}let s=r.get(e);if(!s)continue;await i.Iq.evidence.put({...t,filename:"".concat(s).concat(n)}),l=!0}if(l){var n;null==(n=u.current)||n.reset()}},[h,f,v]=(0,d.useActionState)(p,null);return(0,d.useEffect)(()=>{s||v||C(t,n)},[t,s,v]),(0,d.useEffect)(()=>{let e=function(e,t,r){return async function(t){try{var l,n,s,a,o,d;if(["TEXTAREA","INPUT"].includes(null==t||null==(l=t.target)?void 0:l.nodeName))return;t.preventDefault();let c="function"==typeof(null==(s=navigator)||null==(n=s.clipboard)?void 0:n.read)?await navigator.clipboard.read():null==t||null==(a=t.clipboardData)?void 0:a.files;for(let t of(r(!0),c)){let r;if(null==(o=t.type)?void 0:o.startsWith("image/"))r=t;else for(let e of null==(d=t.types)?void 0:d.filter(e=>e.startsWith("image/")))r=await t.getType(e);if(r){let t=await (0,y.AO)(r),l=await k({type:r.type,data:t,requirementId:e});await i.Iq.evidence.put(l)}}}finally{r(!1)}}}(t,0,a),r=t=>{e(t),m({text:"Successfully pasted evidence"})};return document.addEventListener("paste",r),()=>{document.removeEventListener("paste",r)}},[t,n,a]),(0,d.useEffect)(()=>{let e=e=>{c(e.timeStamp)},t=null==u?void 0:u.current;return null==t||t.addEventListener("reset",e),()=>{null==t||t.removeEventListener("reset",e)}},[u]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h4",{className:"text-2xl block sm:flex mb-6 items-center -translate-y-full",children:"Evidence"}),(0,l.jsxs)("form",{className:"flex flex-col md:flex-row shrink mb-4 -translate-y-[36px]",action:f,ref:u,children:[(0,l.jsxs)("div",{className:"basis-full mb-4 md:mb-0 md:basis-1/3 md:mr-4",children:[(0,l.jsx)(R,{requirementId:t,setUploading:a,uploading:s}),(0,l.jsxs)("div",{className:"relative w-full mt-4",children:[(0,l.jsx)("input",{type:"url",name:"url",id:"url",className:"bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-lg block w-full p-2.5",placeholder:"URL for evidence"}),(0,l.jsx)("button",{type:"submit",className:"absolute top-0 end-0 p-2.5 h-full rounded-e-lg flex items-center px-3 py-2 text-xs font-medium text-gray-600 bg-gray-100 border-l border-gray-200 border border-gray-200",children:(0,l.jsx)(S,{})})]})]}),(0,l.jsx)("div",{className:"flex flex-wrap shrink basis-full md:basis-2/3 content-center",children:(0,l.jsx)(T,{evidence:r,setEvidence:n,lastResetAt:o})})]})]})},F=e=>{let{children:t,debouncedSave:r,formAction:n,isHydrating:s,lastSaved:i,next:a,prev:o,requirement:d}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(w.o,{previous:o,next:a}),(0,l.jsxs)("div",{className:"sticky top-36 left-full flex flex-row-reverse items-center shrink-0 w-1/4 pb-4 z-20 -translate-y-full",children:[(0,l.jsx)("button",{type:"submit",className:"shrink w-24 bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-4 border-b-4 border-green-700 hover:border-green-500 rounded disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200 disabled:shadow-none",disabled:s,tabIndex:30,form:d.element_identifier,children:"Save"}),i&&(0,l.jsxs)("span",{className:"text-sm text-gray-500 mr-2 text-right hidden md:block",children:["Last saved: ",null==i?void 0:i.toLocaleTimeString()]})]}),(0,l.jsx)(P,{requirementId:d.element_identifier}),(0,l.jsx)("form",{id:d.element_identifier,action:n,onChange:r,className:"basis-full",children:t})]})},W=e=>{let{id:t,defaultValue:r,isPending:n,hasPartialValue:s}=e,[i,a]=(0,d.useState)(!!r),o=(0,d.useRef)(null),c=(0,d.useMemo)(()=>()=>!i&&a(!0),[i]),u=(0,d.useMemo)(()=>()=>{if(null==o?void 0:o.current){var e;null==o||null==(e=o.current)||e.dispatchEvent(new Event("change",{bubbles:!0})),c()}},[o,c]);return(0,l.jsxs)("div",{onBlur:u,onClick:c,onKeyUp:c,children:[(0,l.jsxs)("select",{id:t,name:t,ref:o,className:"h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",disabled:n,defaultValue:r,tabIndex:20,children:[(0,l.jsx)("option",{value:j.nW.NOT_IMPLEMENTED,children:"Not Implemented"}),(0,l.jsx)("option",{value:j.nW.IMPLEMENTED,children:"Implemented"}),s&&(0,l.jsx)("option",{value:j.nW.PARTIALLY_IMPLEMENTED,children:"Partially Implemented"}),(0,l.jsx)("option",{value:j.nW.NOT_APPLICABLE,children:"Not Applicable"}),(0,l.jsx)("option",{value:j.nW.NOT_STARTED,children:"Not Started"})]},"".concat(t,"-").concat(n)),!i&&(0,l.jsx)("input",{type:"hidden",name:t,value:r})]})},V=e=>{let{securityRequirement:t,initialState:r,hasPartialValue:n,isPending:s}=e,i="".concat(t.subSubRequirement,".status");return(0,l.jsxs)("div",{className:"flex flex-col md:mr-2 lg:mr-4",children:[(0,l.jsx)("label",{htmlFor:i,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 my-2",children:"Status"}),(0,l.jsx)(W,{id:i,isPending:s,defaultValue:r[i],hasPartialValue:n})]},i)},D=e=>{var t,r;let{securityRequirement:n,initialState:s,isPending:i}=e,o="".concat(n.subSubRequirement,".description"),c=(0,d.useRef)(null),u=(0,d.useRef)(null),m=(0,d.useRef)(null),x=(0,d.useRef)(null),[p,h]=(0,d.useState)(!0),[f,v]=(0,d.useState)(s[o]),b=(0,d.useMemo)(()=>()=>{var e;h(!1),null==c||null==(e=c.current)||e.focus()},[]),g=(0,d.useMemo)(()=>async()=>{if((null==m?void 0:m.current)&&(null==c?void 0:c.current)){var e;h(!0),m.current.innerHTML=await (0,a.xI)(null==c||null==(e=c.current)?void 0:e.value)}},[]),j=()=>{if((null==u?void 0:u.current)&&(null==c?void 0:c.current)){var e;u.current.dataset.replicatedValue=null==c||null==(e=c.current)?void 0:e.value}};return(0,d.useEffect)(()=>{(async()=>{p&&f!==s[o]&&(v(s[o]),await g(),j())})()},[f,s]),(0,d.useEffect)(()=>((null==c?void 0:c.current)&&(c.current.addEventListener("focus",b),c.current.addEventListener("blur",g)),x.current&&x.current.addEventListener("click",b),()=>{(null==c?void 0:c.current)&&(c.current.removeEventListener("focus",b),c.current.removeEventListener("blur",g)),x.current&&x.current.removeEventListener("click",b)}),[c,m]),(0,l.jsxs)("div",{className:"flex flex-col grow w-full lg:w-10/12",ref:x,children:[(0,l.jsx)("label",{htmlFor:o,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 my-2",children:"Description"}),(0,l.jsxs)("div",{className:"relative grow-wrap",ref:u,children:[(0,l.jsx)("textarea",{ref:c,tabIndex:20,name:o,id:o,onInput:j,onFocus:j,className:"min-h-32 grow z-0 w-full rounded-md border border-input bg-transparent px-3 py-3 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm ".concat(p&&(null==c||null==(t=c.current)?void 0:t.value)?"absolute opacity-0":""),disabled:i,defaultValue:s[o]}),(0,l.jsx)("div",{ref:m,tabIndex:-1,className:"min-h-32 relative z-10 md-output w-full rounded-md border border-input bg-white px-3 py-3 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm ".concat(p&&(null==c||null==(r=c.current)?void 0:r.value)?"":"hidden")})]})]})},G=e=>{let{securityRequirement:t,initialState:r,hasPartialValue:n,isPending:s,idx:i}=e;return(0,l.jsx)("li",{className:"mb-6",children:(0,l.jsxs)("fieldset",{className:"flex flex-col grow",children:[(0,l.jsxs)("legend",{className:"text-2xl flex flex-row items-center text-left",children:[(0,l.jsx)(j.oZ,{status:r["".concat(t.subSubRequirement,".status")]}),(0,l.jsx)("h4",{id:t.subSubRequirement,children:t.subSubRequirement})]}),(0,l.jsx)("p",{className:"text-lg my-2",children:t.text}),(0,l.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,l.jsx)(V,{securityRequirement:t,initialState:r,hasPartialValue:n,isPending:s,idx:i}),(0,l.jsx)(D,{securityRequirement:t,initialState:r,isPending:s})]})]})})},O=async(e,t)=>{var r,l;let n={};for(let[e,r]of t.entries()){let t=e.lastIndexOf("."),l=e.substring(0,t),s=e.substring(t+1);n[l]={...(null==n?void 0:n[l])||{},[s]:r}}for(let[e,t]of Object.entries(n))await (null==(l=i.Iq.securityRequirements)?void 0:l.put({id:e,...t}));let s=[];return await (null==(r=i.Iq.requirements)?void 0:r.put({id:e,bySecurityRequirementId:Object.entries(n).reduce((e,t)=>{let[r,l]=t;return e[r]=l.status,s.push(l.status),e},{})})),s},B=e=>{var t;let{requirement:r,initialState:n,setInitialState:s,groupings:i,isHydrating:a,setStatuses:o,prev:c,next:m}=e,{partial_value:x}=(0,u.S)(r.id),[p,h]=(0,d.useState)(null);async function f(e,t){o(await O(r.id,t)),s(Object.fromEntries(t.entries())),h(new Date)}let v=(0,d.useMemo)(()=>(0,y.sg)(async e=>{var t;if(!(null==(t=e.target)?void 0:t.form))return;let r=new FormData(e.target.form);await f(null,r)},250),[r.id,o,s]),[b,g,j]=(0,d.useActionState)(f,n);return(0,l.jsx)(F,{debouncedSave:v,formAction:g,isHydrating:a,lastSaved:p,next:m,prev:c,requirement:r,children:(0,l.jsx)(l.Fragment,{children:null==(t=Object.entries(i))?void 0:t.map((e,t)=>{let[r,s]=e;return(0,l.jsx)("ol",{children:s.map(e=>(0,l.jsx)(G,{securityRequirement:e,hasPartialValue:x>0,initialState:n,isPending:j||a,idx:t},e.element_identifier))},r)})})})},H=RegExp(/\d{1,2}\.\d{1,2}\.\d{1,2}/,"gm"),U=e=>{var t,r,n,i,a,o,d,c;let{groupings:u,initialState:x,isHydrating:w,manifest:y,next:N,prev:k,requirement:q,requirementId:S,setInitialState:I,setStatuses:R,statuses:E,value:L,evidence:_}=e,M=(0,s._A)(),A=(null==(r=y.discussions.byRequirements[S])||null==(t=r[0])?void 0:t.text)||"";return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.B,{requirementId:S}),(0,l.jsxs)("h3",{className:"text-3xl block sm:flex mt-6 items-center",children:["Security Requirements for ",q.requirement," ",q.title,(0,l.jsx)(j.oZ,{statuses:E}),(0,l.jsx)(v.D,{evidence:_})]}),(0,l.jsx)("p",{className:"text-base discussion",dangerouslySetInnerHTML:{__html:A.replaceAll(H,e=>'<a href="#?element='.concat(e,'">').concat(e,"</a>"))}}),(0,l.jsxs)("aside",{className:"flex flex-wrap justify-between items-center w-full mx-auto",children:[(0,l.jsx)("div",{className:"flex mb-4 sm:mb-1",children:(0,l.jsxs)("a",{href:"https://csrc.nist.gov/projects/cprt/catalog#/cprt/framework/version/SP_800_171_3_0_0/home?element=".concat(q.id),target:"_blank",rel:"noreferrer",className:"text-xs text-gray-600",children:["View CPRT ",q.id]})}),(0,l.jsx)(f,{rows:[{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{popoverTarget:"poamable-popover",className:"uppercase flex items-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"POAMable"})," ",(0,l.jsx)(b.G,{})]}),(0,l.jsxs)(g.A,{id:"poamable-popover",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{children:"A security requirement can only be used in the POA&M when it has a value of 1. The only exception is 03.13.11 wherein encryption is used but not FIPS-validated. If the requirement is not met and cannot be POA&M-ed then you cannot achieve CMMC L2 certification."})]})]}),visible:!!(null==L?void 0:L.value),value:(null==L?void 0:L.value)===1||"03.13.11"===S?"Yes":"No"},{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{popoverTarget:"revision-popover",className:"uppercase flex items-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"Revision"})," ",(0,l.jsx)(b.G,{})]}),(0,l.jsxs)(g.A,{id:"revision-popover",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{children:"What NIST 800-171 revision(s) this control appears in."})]})]}),visible:M===s.AT.V3&&!!(null==L||null==(n=L.revision)?void 0:n.length),value:null==L||null==(i=L.revision)?void 0:i.join(", ")},{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{popoverTarget:"value-popover",className:"uppercase flex items-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"Value"})," ",(0,l.jsx)(b.G,{})]}),(0,l.jsxs)(g.A,{id:"value-popover",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{children:"The value this control has currently in CMMC."})]})]}),visible:!0,value:null==L?void 0:L.value},{title:"Partial Value",visible:(null!=(c=null==L?void 0:L.partial_value)?c:0)>0,value:null==L?void 0:L.partial_value},{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{popoverTarget:"deprecated-popover",className:"uppercase flex items-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"Deprecates"})," ",(0,l.jsx)(b.G,{})]}),(0,l.jsxs)(g.A,{id:"deprecated-popover",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{children:"This security requirement incorporates the following controls from revision 2."})]})]}),visible:M===s.AT.V3&&!!(null==L||null==(a=L.withdrawn_from)?void 0:a.length),className:"hidden md:inline",value:null==L||null==(o=L.withdrawn_from)?void 0:o.map(e=>(0,l.jsx)(p(),{href:"/r2/requirement/".concat(e),className:"text-xs mr-2",children:e},e))},{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{popoverTarget:"deprecated-value-popover",className:"uppercase flex items-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"Deprecated Value"})," ",(0,l.jsx)(b.G,{})]}),(0,l.jsxs)(g.A,{id:"deprecated-value-popover",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{children:"This is the aggregate value of all controls this security requirement has incorporated. It is an estimate until CMMC is updated to use 800-171 revision 3."})]})]}),visible:M===s.AT.V3&&!!(null==L||null==(d=L.withdrawn_from)?void 0:d.length),value:(0,m.k)(null==L?void 0:L.aggregate_value_withdrawn_from)}]})]}),(0,l.jsx)("section",{className:"w-full flex flex-col",children:(0,l.jsx)(B,{requirement:q,groupings:u,initialState:x,setInitialState:I,isHydrating:w,setStatuses:R,prev:k,next:N})})]})},K=/\d{2}.\d{2}.\d{2},?/gm,z=e=>{let{text:t}=e,r=(0,s._A)(),n=(0,s.b0)(r);if(K.test(t)){var i;return[t.replaceAll(K,"").replace("and","").replace(".",""),...null==(i=t.match(K))?void 0:i.map(e=>{let t=e.replace(",","");return(0,l.jsx)(p(),{href:"".concat(n,"/requirement/").concat(t),className:"text-xs mr-1",children:e},t)})]}return t},Z=e=>{var t,r,n,s,i,a,o;let{initialState:d,isHydrating:c,manifest:u,next:m,prev:x,requirement:p,requirementId:w,setInitialState:y,setStatuses:N,statuses:k,value:q,withdrawn:S,groupings:I,evidence:R}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.B,{requirementId:w}),(0,l.jsxs)("h3",{className:"text-3xl mt-6 block sm:flex items-center",children:["Security Requirements for ",p.requirement,(0,l.jsx)(j.oZ,{statuses:k}),(0,l.jsx)(v.D,{evidence:R})]}),(0,l.jsxs)("div",{id:"alert-additional-content-5",className:"p-4 border border-yellow-100 text-yellow-800  rounded-lg bg-yellow-50 ",role:"alert",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{className:"sr-only",children:"Info"}),(0,l.jsx)("h3",{className:"text-lg font-sm text-gray-800 ",children:"Withdrawn"})]}),(0,l.jsx)("div",{className:"mt-2 mb-4 text-xs text-gray-800",children:(0,l.jsx)("p",{className:"mb-2",children:"This security requirement has been withdrawn from NIST-SP 800-171 revision 3, but is retained as CMMC is using revision 2."})})]}),(0,l.jsx)("p",{className:"text-base discussion",dangerouslySetInnerHTML:{__html:(null==(r=u.discussions.byRequirements[w])||null==(t=r[0])?void 0:t.text)||""}}),(0,l.jsxs)("aside",{className:"flex flex-wrap justify-between items-center w-full mx-auto",children:[(0,l.jsx)("div",{className:"flex mb-4 sm:mb-1",children:(0,l.jsxs)("a",{href:"https://csrc.nist.gov/projects/cprt/catalog#/cprt/framework/version/SP_800_171_3_0_0/home?element=".concat(p.id),target:"_blank",rel:"noreferrer",className:"text-xs text-gray-600",children:["View CPRT ",p.id]})}),(0,l.jsx)(f,{rows:[{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{popoverTarget:"revision-popover",className:"uppercase flex items-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"Revision"})," ",(0,l.jsx)(b.G,{})]}),(0,l.jsxs)(g.A,{id:"revision-popover",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{children:"What NIST 800-171 revision(s) this control appears in."})]})]}),visible:null==q||null==(n=q.revision)?void 0:n.length,value:null==q||null==(s=q.revision)?void 0:s.join(", ")},{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{popoverTarget:"value-popover",className:"uppercase flex items-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"Value"})," ",(0,l.jsx)(b.G,{})]}),(0,l.jsxs)(g.A,{id:"value-popover",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{children:"The value this control has currently in CMMC."})]})]}),visible:!0,value:null==q?void 0:q.value},{title:"Partial Value",visible:(null!=(o=null==q?void 0:q.partial_value)?o:0)>0,value:null==q?void 0:q.partial_value},{title:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{popoverTarget:"deprecated-value-popover",className:"uppercase flex items-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"Withdrawn Reason"})," ",(0,l.jsx)(b.G,{})]}),(0,l.jsxs)(g.A,{id:"deprecated-value-popover",children:[(0,l.jsx)(b.G,{}),(0,l.jsx)("span",{children:"Why this security control was withdrawn."})]})]}),visible:!0,className:"hidden md:block",value:(0,l.jsx)(z,{text:null==S||null==(a=S[0])||null==(i=a.element)?void 0:i.text})}]})]}),(0,l.jsx)("section",{className:"w-full flex flex-col",children:(0,l.jsx)(B,{requirement:p,initialState:d,setInitialState:y,isHydrating:c,setStatuses:N,prev:x,next:m,groupings:I})})]})};a.xI.use({async:!0,pedantic:!1,gfm:!0,breaks:!0});let Y=e=>{var t;let{requirementId:r}=e,a=(0,s._A)(),m=(0,s.b0)(a),[x,p]=(0,d.useState)({}),[h,f]=(0,d.useState)(!1),[v,b]=(0,d.useState)([]),g=(0,n.u2)(),j=(0,o.useRouter)(),w=(0,u.S)(r),y=null==(t=(0,c.Z)(r.slice(0,5)))?void 0:t.requirementEvidence(r),N=g.withdrawReason.byRequirements[r],k=(0,d.useMemo)(()=>(null==g?void 0:g.securityRequirements.byRequirements[r])||[],[g,r]),q=(0,d.useMemo)(()=>(null==g?void 0:g.requirements.byId[r])||null,[g,r]),S=(0,d.useMemo)(()=>{let e={};for(let t of k)t.text&&(e[t.subRequirement]||(e[t.subRequirement]=[]),e[t.subRequirement].push(t));return e},[k]),[I,R]=(0,d.useMemo)(()=>{let e=(null==g?void 0:g.requirements.byFamily[null==q?void 0:q.family])||[],t=e.findIndex(e=>e.id===r),l=e[t-1],n=e[t+1];if(!l||!n){var s,i,a;let e=g.families.elements,t=e.findIndex(e=>e.id===q.family);if(!l){let r=null==e||null==(s=e[t-1])?void 0:s.id,n=g.requirements.byFamily[r];l=null==n?void 0:n[(null==n?void 0:n.length)-1]}if(!n){let r=null==e||null==(i=e[t+1])?void 0:i.id;n=null==(a=g.requirements.byFamily[r])?void 0:a[0]}}return[l,n]},[q,r,g]);return((0,d.useEffect)(()=>{!async function(){f(!0);let e=k.map(e=>e.subSubRequirement),t=await i.Iq.securityRequirements.getAll(IDBKeyRange.bound(e[0],e[e.length-1])),r=[],l=null==t?void 0:t.reduce((e,t)=>(e["".concat(t.id,".status")]=t.status,e["".concat(t.id,".description")]=t.description,r.push(t.status),e),{});b(r),p(l),f(!1)}()},[r,p,k,b,f]),(0,d.useEffect)(()=>{let e=e=>{let t=new URL("".concat(window.location.origin,"/").concat(e.newURL.split("#")[1]));t.searchParams.get("element")&&(history.replaceState(null,"",window.location.pathname+window.location.search),j.push("".concat(m,"/requirement/").concat(t.searchParams.get("element"))))};window.addEventListener("hashchange",e);let t=e=>{if(e.ctrlKey&&"s"===e.key){var t;e.preventDefault();let r=null==(t=document.forms)?void 0:t[0];null==r||r.requestSubmit()}};return document.addEventListener("keydown",t),()=>{window.removeEventListener("hashchange",e),document.removeEventListener("keydown",t)}},[j]),N)?(0,l.jsx)(Z,{groupings:S,initialState:x,isHydrating:h,manifest:g,next:R,prev:I,requirement:q,requirementId:r,setInitialState:p,setStatuses:b,statuses:v,value:w,withdrawn:N,evidence:y}):(null==k?void 0:k.length)?(0,l.jsx)(U,{groupings:S,initialState:x,isHydrating:h,manifest:g,next:R,prev:I,requirement:q,requirementId:r,setInitialState:p,setStatuses:b,statuses:v,value:w,evidence:y}):null}}}]);